{% extends 'base.html' %}
{% block content %}

<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold text-success">
      <i class="bi bi-speedometer2"></i> Dashboard {{ user.role|capitalize }}
    </h3>
    <span class="text-muted small">
      Selamat datang, <strong>{{ user.username }}</strong> â€” Sistem Informasi Penomoran Ijazah MDT (SINDI)
    </span>
  </div>

  <!-- Statistik Ringkas -->
  <div class="row g-3">
    {% if user.role == 'mdt' %}
      <div class="col-md-4">
        <div class="card border-0 shadow-sm p-3 text-center">
          <i class="bi bi-send-check display-6 text-success"></i>
          <h3 id="count-total" data-count="{{ data['pengajuan_total'] or 0 }}">0</h3>
          <p class="text-muted small">Total Pengajuan</p>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card border-0 shadow-sm p-3 text-center">
          <i class="bi bi-hourglass-split display-6 text-warning"></i>
          <h3 id="count-menunggu" data-count="{{ data['menunggu'] or 0 }}">0</h3>
          <p class="text-muted small">Menunggu Verifikasi</p>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card border-0 shadow-sm p-3 text-center">
          <i class="bi bi-award display-6 text-primary"></i>
          <h3 id="count-ditetapkan" data-count="{{ data['ditetapkan'] or 0 }}">0</h3>
          <p class="text-muted small">Sudah Ditetapkan</p>
        </div>
      </div>

    {% elif user.role == 'kankemenag' %}
      <div class="col-md-4">
        <div class="card border-0 shadow-sm p-3 text-center">
          <i class="bi bi-list-task display-6 text-success"></i>
          <h3 id="count-total" data-count="{{ data['total'] or 0 }}">0</h3>
          <p class="text-muted small">Total Pengajuan Diterima</p>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card border-0 shadow-sm p-3 text-center">
          <i class="bi bi-clock-history display-6 text-warning"></i>
          <h3 id="count-menunggu" data-count="{{ data['menunggu'] or 0 }}">0</h3>
          <p class="text-muted small">Menunggu Verifikasi</p>
        </div>
      </div>

      <div class="col-md-4">
        <div class="card border-0 shadow-sm p-3 text-center">
          <i class="bi bi-send-check-fill display-6 text-primary"></i>
          <h3 id="count-verifikasi" data-count="{{ data['diverifikasi'] or 0 }}">0</h3>
          <p class="text-muted small">Sudah Diverifikasi</p>
        </div>
      </div>

    {% elif user.role == 'kanwil' %}
      <div class="col-md-3">
        <div class="card border-0 shadow-sm p-3 text-center">
          <i class="bi bi-journal-check display-6 text-success"></i>
          <h3 id="count-total" data-count="{{ data['total'] or 0 }}">0</h3>
          <p class="text-muted small">Total Pengajuan Diverifikasi</p>
        </div>
      </div>

      <div class="col-md-3">
        <div class="card border-0 shadow-sm p-3 text-center">
          <i class="bi bi-award-fill display-6 text-primary"></i>
          <h3 id="count-ditetapkan" data-count="{{ data['ditetapkan'] or 0 }}">0</h3>
          <p class="text-muted small">Sudah Ditetapkan</p>
        </div>
      </div>

      <div class="col-md-3">
        <div class="card border-0 shadow-sm p-3 text-center">
          <i class="bi bi-bar-chart display-6 text-info"></i>
          <h3 id="count-diverifikasi" data-count="{{ data['diverifikasi'] or 0 }}">0</h3>
          <p class="text-muted small">Sudah Diverifikasi</p>
        </div>
      </div>

      <div class="col-md-3">
        <div class="card border-0 shadow-sm p-3 text-center">
          <i class="bi bi-people-fill display-6 text-warning"></i>
          <h3 id="count-santri" data-count="{{ data['total_santri'] or 0 }}">0</h3>
          <p class="text-muted small">Total Santri Mendapat Nomor</p>
        </div>
      </div>
    {% endif %}
  </div>

  <!-- Grafik Mini -->
  <div class="card mt-4 border-0 shadow-sm">
    <div class="card-header bg-success text-white">
      <i class="bi bi-bar-chart-line"></i> Statistik Visual
    </div>
    <div class="card-body">
      <canvas id="chartDashboard" height="100"></canvas>
    </div>
  </div>
</div>

<!-- ===== Chart.js ===== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const ctx = document.getElementById('chartDashboard');
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['Menunggu', 'Diverifikasi', 'Ditetapkan'],
      datasets: [{
        label: 'Jumlah Pengajuan',
        data: [{{ data['menunggu'] or 0 }}, {{ data['diverifikasi'] or 0 }}, {{ data['ditetapkan'] or 0 }}],
        backgroundColor: ['#ffc107', '#0d6efd', '#198754'],
        borderWidth: 1,
        borderRadius: 5
      }]
    },
    options: {
      scales: { y: { beginAtZero: true } },
      plugins: { legend: { display: false } }
    }
  });
});
</script>

<!-- ===== Animasi Angka + Fade-in Card ===== -->
<style>
.card {
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.6s ease-in-out;
}
.card.appear {
  opacity: 1;
  transform: translateY(0);
}
</style>

<script>
document.addEventListener("DOMContentLoaded", function() {
  // --- animasi angka naik ---
  function animateValue(id, start, end, duration) {
    const obj = document.getElementById(id);
    if (!obj) return;
    const range = end - start;
    const minTimer = 50;
    const stepTime = Math.abs(Math.floor(duration / range));
    const timer = Math.max(stepTime, minTimer);
    let startTime = null;

    function step(timestamp) {
      if (!startTime) startTime = timestamp;
      const progress = timestamp - startTime;
      const value = Math.min(start + (range * progress / duration), end);
      obj.textContent = Math.floor(value);
      if (progress < duration) {
        window.requestAnimationFrame(step);
      } else {
        obj.textContent = end;
      }
    }
    window.requestAnimationFrame(step);
  }

  // Jalankan animasi naik angka
  document.querySelectorAll("[data-count]").forEach(el => {
    const target = parseInt(el.getAttribute("data-count")) || 0;
    animateValue(el.id, 0, target, 1200);
  });
  

  // --- efek fade-in kartu ---
  const cards = document.querySelectorAll('.card');
  cards.forEach((card, i) => {
    setTimeout(() => card.classList.add('appear'), i * 150);
  });

// Efek muncul satu per satu (fade-in)
document.addEventListener("DOMContentLoaded", () => {
  const cards = document.querySelectorAll('.card');
  cards.forEach((card, i) => {
    setTimeout(() => card.classList.add('appear'), i * 150);
    
  });
});
</script>

{% endblock %}
