{% extends 'base.html' %}
{% block content %}

<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold text-success">
      <i class="bi bi-pencil-square"></i> Pengajuan Nomor Ijazah MDT
    </h3>
    <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#formPengajuanModal">
      <i class="bi bi-plus-circle"></i> Buat Pengajuan Baru
    </button>
  </div>

  <!-- Modal Form Pengajuan Baru -->
  <div class="modal fade" id="formPengajuanModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <form action="{{ url_for('pengajuan_mdt') }}" method="POST" enctype="multipart/form-data" class="modal-content shadow-sm border-0">
        <div class="modal-header bg-success text-white">
          <h5 class="modal-title"><i class="bi bi-pencil-square"></i> Form Pengajuan Nomor Ijazah</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label fw-semibold">Nama MDT</label>
              <input type="text" class="form-control" name="nama_mdt" value="{{ user.kode_mdt }}" readonly>
            </div>

            <div class="mb-3 col-md-6">
              <label class="form-label fw-semibold">Kabupaten / Kota</label>
              <select name="kabupaten" class="form-select">
                <option value="">Pilih Kabupaten/Kota</option>
                {% for kab in kabupaten_list %}
                  <option value="{{ kab }}">{{ kab }}</option>
                {% endfor %}
              </select>

            </div>

            <div class="mb-3 col-md-6">
              <label class="form-label fw-semibold">Jenjang</label>
              <select name="jenjang" class="form-select" required>
                <option value="">Pilih Jenjang</option>
                {% for j in jenjang_list %}
                  <option value="{{ j }}">{{ j }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold">Tahun Pelajaran</label>
              <input type="text" class="form-control" name="tahun_pelajaran" placeholder="2024/2025" required>
            </div>

            <div class="col-md-4">
              <label class="form-label fw-semibold">Jumlah Lulusan</label>
              <input type="number" class="form-control" name="jumlah_lulus" placeholder="contoh: 25" required>
            </div>

            <div class="col-md-12">
              <label class="form-label fw-semibold">Upload File Daftar Lulusan</label>
              <input type="file" class="form-control" name="file_lulusan" accept=".pdf,.xls,.xlsx" required>
              <small class="text-muted">Format: PDF / Excel (kolom Nama & NIS wajib ada)</small>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success"><i class="bi bi-send-check"></i> Kirim</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Tabel Daftar Pengajuan -->
  <div class="card shadow-sm border-0 mt-4">
    <div class="card-header bg-success text-white">
      <i class="bi bi-archive"></i> Daftar Pengajuan MDT
    </div>
    <div class="card-body table-responsive">
      {% if pengajuans %}
      <table class="table table-hover align-middle">
        <thead class="table-success">
          <tr>
            <th>No</th>
            <th>Nomor Batch</th>
            <th>Kota/Kabupaten</th>
            <th>Jenjang</th>
            <th>Tahun</th>
            <th>Jumlah</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          {% for p in pengajuans %}
          <tr>
            <td>{{ loop.index }}</td>
            <td><span class="badge bg-secondary">{{ p[1] }}</span></td>
            <td>{{ p[8] or '-' }}</td>  <!-- kabupaten -->
            <td>{{ p[3] }}</td>         <!-- jenjang -->
            <td>{{ p[4] }}</td>         <!-- tahun -->
            <td>{{ p[5] }}</td>         <!-- jumlah -->
            <td>
              {% if p[7] == 'Diverifikasi' %}
              <span class="badge bg-success">Diverifikasi</span>
              {% elif p[7] == 'Ditetapkan' %}
              <span class="badge bg-primary">Ditetapkan</span>
              {% elif p[7] == 'Ditolak' %}
              <span class="badge bg-danger">Ditolak</span>
              {% else %}
              <span class="badge bg-warning text-dark">{{ p[7] or 'Menunggu' }}</span>
              {% endif %}
            </td>

          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <div class="text-center text-muted py-4">
        <i class="bi bi-inbox display-4"></i>
        <p>Belum ada pengajuan yang dikirim.</p>
      </div>
      {% endif %}
    </div>
  </div>
</div>

{% endblock %}
